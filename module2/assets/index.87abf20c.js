var v=Object.defineProperty;var w=(l,e,s)=>e in l?v(l,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[e]=s;var i=(l,e,s)=>(w(l,typeof e!="symbol"?e+"":e,s),s);import{v as y}from"./vendor.e5975509.js";const _=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}};_();class T{constructor(e){i(this,"parentElement");i(this,"game");i(this,"gameBody");i(this,"gameHeader");i(this,"addGame",()=>{this.game.className="game",this.game.append(this.gameHeader,this.gameBody)});i(this,"addHeader",()=>{const e=`
      <div class="game__info">
        <div class="game__logo">2048</div>

        <div class="game__score info-game">
          <div class="info-game__name">Score </div>
          <div class="info-game__score">0</div>
        </div>

        <div class="game__time info-game">
          <div class="info-game__name">Moves </div>
          <div class="info-game__time">0</div>
        </div>

      </div>

      <div class="game__info">
        <div class="game__rules">Join the numbers and get to the <span>2048 tile!</span></div>
        <button class="game__new-game-btn btn">New Game</button>
        <button class="game__options-btn btn">\u{1F4CA}</button>
      </div>
    `;this.gameHeader.className="game__header",this.gameHeader.innerHTML=e});i(this,"addGameBody",()=>{const e=new Array(25).fill("0").map(()=>'<div class="cell"></div>').join("");this.gameBody.className="game__body",this.gameBody.innerHTML=e});this.parentElement=e,this.game=document.createElement("div"),this.gameHeader=document.createElement("div"),this.gameBody=document.createElement("div"),this.addHeader(),this.addGameBody(),this.addGame(),this.parentElement.append(this.game)}}class b{constructor(e){i(this,"move");i(this,"handler",e=>{let s="moveLeft";switch(e.code){case"ArrowLeft":s="moveLeft";break;case"ArrowRight":s="moveRight";break;case"ArrowUp":s="moveUp";break;case"ArrowDown":s="moveDown";break}this.move(s)});i(this,"addListeners",()=>{document.addEventListener("keydown",this.handler)});this.addListeners(),this.move=e}}const m=class{constructor(e,s,a){i(this,"elem");i(this,"minDistance");i(this,"maxTime");i(this,"startTime",0);i(this,"didDown",!1);i(this,"startPos",{x:0,y:0});i(this,"endPos",{x:0,y:0});i(this,"move");i(this,"down",e=>{e.preventDefault(),this.startTime=Date.now(),this.startPos=this.endPos=m.position(e)});i(this,"up",e=>{e.preventDefault();const s=Date.now()-this.startTime;if(this.endPos=m.position(e),s<=this.maxTime){const a=m.getOffsets(this.endPos,this.startPos);if(m.getDistance(a)>this.minDistance){const n=m.getDirections(a);this.move(n)}}this.startPos={x:0,y:0},this.endPos={x:0,y:0}});i(this,"addListeners",()=>{this.elem.addEventListener("touchstart",this.down),document.addEventListener("touchend",this.up),this.elem.addEventListener("mousedown",this.down),document.addEventListener("mouseup",this.up)});this.elem=e,this.minDistance=(a==null?void 0:a.minDistance)||100,this.maxTime=(a==null?void 0:a.maxTime)||500,this.move=s,this.addListeners()}};let c=m;i(c,"position",e=>"touches"in e?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY}),i(c,"getOffsets",(e,s)=>({x:e.x-s.x,y:e.y-s.y})),i(c,"getDistance",e=>Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))),i(c,"getDirections",({x:e,y:s})=>Math.abs(e)>Math.abs(s)?e>0?"moveRight":"moveLeft":s<0?"moveUp":"moveDown");const u=class{};let o=u;i(o,"isGameStop",!1),i(o,"idGame",null),i(o,"gameStartTime",Date.now()),i(o,"rating",[]),i(o,"getRating",()=>u.rating.sort((e,s)=>e.time-s.time)),i(o,"gameStarts",()=>{u.idGame=y(),u.gameStartTime=Date.now()}),i(o,"getGameTime",()=>Math.ceil((Date.now()-u.gameStartTime)/1e3));const f=class{};let d=f;i(d,"checkToLeft",e=>{for(let s=0;s<=4;s++)for(let a=0;a<=4;a++)if(e[s][a]&&(e[s][a]===e[s][a-1]||e[s][a-1]===0))return!0;return!1}),i(d,"checkToRight",e=>{for(let s=0;s<=4;s++)for(let a=4;a>=0;a--)if(e[s][a]&&(e[s][a]===e[s][a+1]||e[s][a+1]===0))return!0;return!1}),i(d,"checkToUp",e=>{for(let s=0;s<=4;s++)for(let a=1;a<=4;a++)if(e[a][s]&&(e[a-1][s]===0||e[a][s]===e[a-1][s]))return!0;return!1}),i(d,"checkToDown",e=>{for(let s=0;s<=4;s++)for(let a=3;a>=0;a--)if(e[a][s]&&(console.log(e[a+1][s]),e[a][s]===e[a+1][s]||e[a+1][s]===0))return!0;return!1}),i(d,"checkAll",e=>[f.checkToLeft(e),f.checkToRight(e),f.checkToUp(e),f.checkToDown(e)]);const g=class{static playSound(e){new Audio(`./../src/assets/audio/${e}.mp3`).play()}};let r=g;i(r,"randomNum",e=>Math.floor(Math.random()*e)),i(r,"randomValue",()=>Math.floor(Math.random()*101)>=90?4:2),i(r,"randomCoordinates",(e,s)=>{const a=e[s],t=Math.floor(Math.abs(a/5));return[a-t*5,t]}),i(r,"identifyBlankCells",e=>e.flat().reduce((s,a,t)=>(a===0&&s.push(t),s),[])),i(r,"dataForRandomCell",e=>{const s=g.randomNum(e.length),[a,t]=g.randomCoordinates(e,s);return{randomValue:g.randomValue(),x:a,y:t}}),i(r,"calculateFontSize",(e,s)=>{const a=s.toString().length;return a===1?e:e-a*5});class E{constructor(e,s,a,t){i(this,"result");i(this,"scoreForWin");i(this,"moves");i(this,"field");i(this,"elemShowingScore");i(this,"elemShowingMoves");i(this,"gameBody");i(this,"baseFontSize");i(this,"isAllowedToLeft");i(this,"isAllowedToRight");i(this,"isAllowedToUp");i(this,"isAllowedToDown");i(this,"isWin");i(this,"renderResult");i(this,"step",e=>{o.isGameStop||this[e]()});i(this,"end",()=>{this.tact(),r.playSound("step")});i(this,"changeElem",(e,s,a,t,n)=>{const h=document.querySelector(`.game-cell[data-coordinates="${e},${s}"]`);if(h){const p=r.calculateFontSize(this.baseFontSize,a);h.style.cssText=`top: ${t*20}%; 
      left: ${n*20}%; 
      font-size: ${p}px`,h.dataset.coordinates=`${t},${n}`,h.textContent=""+a,h.className=`game-cell game-cell_color-color_${a}`,this.checkToWin(a)}});i(this,"removeElem",(e,s)=>{const a=document.querySelector(`.game-cell[data-coordinates="${e},${s}"]`);a&&a.remove()});i(this,"updateScore",e=>{this.result+=e,this.elemShowingScore.textContent=this.result.toString()});i(this,"updateMoves",()=>{this.moves++,console.log(this.moves),this.elemShowingMoves.textContent=this.moves.toString()});i(this,"createRandomCell",(e,s,a)=>{const t=document.createElement("div");t.classList.add("game-cell",`game-cell_color-color_${e}`,"game-cell_animate-add"),t.textContent=e.toString(),t.dataset.coordinates=`${a},${s}`,t.style.cssText=`left: ${s*20}%; top: ${a*20}%;`,this.field[a][s]=e,this.gameBody.append(t)});i(this,"checkToLose",()=>{[this.isAllowedToLeft,this.isAllowedToRight,this.isAllowedToUp,this.isAllowedToDown]=d.checkAll(this.field),!this.isAllowedToLeft&&!this.isAllowedToRight&&!this.isAllowedToUp&&!this.isAllowedToDown&&(r.playSound("lose"),this.renderResult({isWin:!1,score:this.result,steps:this.moves}))});i(this,"checkToWin",e=>{e>=this.scoreForWin&&(r.playSound("win"),this.isWin=!0,this.renderResult({isWin:!0,score:this.result,steps:this.moves}))});i(this,"tact",()=>{const e=r.identifyBlankCells(this.field);if(e.length){const{randomValue:s,x:a,y:t}=r.dataForRandomCell(e);this.createRandomCell(s,a,t)}this.checkToLose()});this.result=0,this.scoreForWin=2048,this.moves=0,this.field=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],this.elemShowingScore=e,this.elemShowingScore.textContent="0",this.elemShowingMoves=s,this.elemShowingMoves.textContent="0",this.gameBody=a,this.renderResult=t,this.baseFontSize=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--font-size-cell")),this.isAllowedToLeft=!0,this.isAllowedToRight=!0,this.isAllowedToUp=!0,this.isAllowedToDown=!0,this.isWin=!1,this.tact()}moveLeft(){if(!(!this.isAllowedToLeft||this.isWin)){this.updateMoves();for(let e=0;e<=4;e++){let s=0;for(let a=0;a<=4;a++)if(this.field[e][a])for(let t=a;t>s;t--)this.field[e][t]!=this.field[e][t-1]&&this.field[e][t-1]!=0?s++:this.field[e][t]===this.field[e][t-1]?(this.field[e][t-1]=this.field[e][t]+this.field[e][t-1],this.field[e][t]=0,s++,this.removeElem(e,t-1),this.updateScore(this.field[e][t-1]),this.changeElem(e,t,this.field[e][t-1],e,t-1)):this.field[e][t-1]===0&&(this.field[e][t-1]=this.field[e][t],this.field[e][t]=0,this.changeElem(e,t,this.field[e][t-1],e,t-1))}this.end()}}moveRight(){if(!(!this.isAllowedToRight||this.isWin)){this.updateMoves();for(let e=0;e<=4;e++){let s=3;for(let a=4;a>=0;a--)if(this.field[e][a])for(let t=a;t<=s;t++)this.field[e][t]!==this.field[e][t+1]&&this.field[e][t+1]!==0?s--:this.field[e][t]===this.field[e][t+1]?(this.field[e][t+1]=this.field[e][t]+this.field[e][t+1],this.field[e][t]=0,s--,this.removeElem(e,t+1),this.updateScore(this.field[e][t+1]),this.changeElem(e,t,this.field[e][t+1],e,t+1)):this.field[e][t+1]===0&&(this.field[e][t+1]=this.field[e][t],this.field[e][t]=0,this.changeElem(e,t,this.field[e][t+1],e,t+1))}this.end()}}moveUp(){if(!(!this.isAllowedToUp||this.isWin)){this.updateMoves();for(let e=0;e<=4;e++){let s=0;for(let a=0;a<=4;a++)if(this.field[a][e])for(let t=a;t>s;t--)this.field[t][e]!=this.field[t-1][e]&&this.field[t-1][e]!=0?s++:this.field[t][e]===this.field[t-1][e]?(this.field[t-1][e]=this.field[t][e]+this.field[t-1][e],this.field[t][e]=0,s++,this.removeElem(t-1,e),this.updateScore(this.field[t-1][e]),this.changeElem(t,e,this.field[t-1][e],t-1,e)):this.field[t-1][e]===0&&(this.field[t-1][e]=this.field[t][e],this.field[t][e]=0,this.changeElem(t,e,this.field[t-1][e],t-1,e))}this.end()}}moveDown(){if(!(!this.isAllowedToDown||this.isWin)){this.updateMoves();for(let e=0;e<=4;e++){let s=4;for(let a=4;a>=0;a--)if(this.field[a][e])for(let t=a;t<s;t++)this.field[t][e]!=this.field[t+1][e]&&this.field[t+1][e]!=0?s--:this.field[t][e]===this.field[t+1][e]?(this.field[t+1][e]=this.field[t][e]+this.field[t+1][e],this.field[t][e]=0,s--,this.removeElem(t+1,e),this.updateScore(this.field[t+1][e]),this.changeElem(t,e,this.field[t+1][e],t+1,e)):this.field[t+1][e]===0&&(this.field[t+1][e]=this.field[t][e],this.field[t][e]=0,this.changeElem(t,e,this.field[t+1][e],t+1,e))}this.end()}}}class S{constructor(e){i(this,"parentElem");i(this,"gameResult");i(this,"inputName",null);i(this,"isWin",!0);i(this,"score",0);i(this,"steps",0);i(this,"time",0);i(this,"render",({isWin:e,score:s,steps:a})=>{o.isGameStop=!0,this.isWin=e,this.score=s,this.steps=a,this.time=o.getGameTime();const t=`
    <div name="result" class="result" >
    <div class="result__wrap">
      ${e?'<p class="result__text"><span>Victory</span></p>':'<p class="result__text"><span>Losing</span></p>'}  
      </div>
      <div class="result__wrap">
      ${e?'<img class="result__img" src="./src/assets/win.jpg" alt="win">':' <img class="result__img" src="./src/assets/lose.jpg" alt="lose">'}
      </div>
      <div class="result__wrap">
         <p class="result__text">Your result: <span>${a}steps</span>,
          ${this.time}sec</p>
      </div>
      <div class="result__wrap input-wrap">
       <input class="result__input-name" type="text" placeholder="Enter your name" autocomplete="off"/>
      </div>
      <div class="result__wrap btn-wrap">
        <button class="btn result__btn-submit" >Ok</button>
        <button class="btn result__btn-cancel">Cancel</button>
      </div>
    </div>
  `;this.gameResult.className="game__result",this.gameResult.innerHTML=t,this.parentElem.appendChild(this.gameResult),this.listener()});i(this,"listener",()=>{if(this.gameResult){const e=this.gameResult.querySelector(".result__btn-submit"),s=this.gameResult.querySelector(".result__btn-cancel");this.inputName=this.gameResult.querySelector(".result__input-name"),e&&s&&(e.addEventListener("click",this.submit),s.addEventListener("click",this.cancel))}});i(this,"cancel",()=>{this.inputName&&(o.isGameStop=!1,this.inputName.value="",this.gameResult.remove())});i(this,"submit",()=>{this.inputName&&this.inputName.value&&o.rating.push({name:this.inputName.value,isWin:this.isWin,steps:this.steps,score:this.score,time:this.time}),this.cancel()});this.parentElem=e,this.gameResult=document.createElement("div")}}class L{constructor(e){i(this,"parentElem");i(this,"gameRating");i(this,"isData");i(this,"data");i(this,"render",()=>{let e=`
    <div class="rating">
      <div class="spinner-wrap">
        <img src="./../src/assets/spinner.svg" alt="spinner">
        <p>Loading...</p>
      </div>
    </div>
   `;this.isData&&(e=`<div class="rating">
      <h2 class="rating__title">Rating</h2>
      <table class="rating-table">
        <thead>
          <tr>
            <th>Result</th>
            <th>Name</th>
            <th>Steps</th>
            <th>Score</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody>
          ${this.data.map(({name:a,isWin:t,steps:n,score:h,time:p})=>`<tr>
            <td>${t?"win":"lose"}</td>
            <td>${a}</td>
            <td>${n}</td>
            <td>${h}</td>
            <td>${p}</td>
          </tr>`).join(" ")}
        </tbody>
      </table>
    </div>
    `),this.gameRating.className="game__rating game__rating_animate-add",this.gameRating.innerHTML=e,this.parentElem.appendChild(this.gameRating)});i(this,"remove",()=>{o.isGameStop=!1,this.gameRating.classList.remove("game__rating_animate-add"),this.gameRating.classList.add("game__rating_animate-remove"),setTimeout(()=>{this.gameRating.remove(),this.remove()},250)});this.parentElem=e,this.gameRating=document.createElement("div"),this.isData=!0,this.data=o.getRating(),o.isGameStop=!0,this.render()}}class R{constructor(e){i(this,"parentElement");i(this,"game",null);i(this,"score",null);i(this,"moves",null);i(this,"btnNewGame",null);i(this,"btnOptions",null);i(this,"gameBody",null);i(this,"rating",null);i(this,"playGame",null);i(this,"move",e=>{this.playGame&&this.playGame.step(e)});i(this,"activeParts",()=>{this.game=this.parentElement.querySelector(".game"),this.game&&(this.score=this.game.querySelector(".info-game__score"),this.moves=this.game.querySelector(".info-game__time"),this.btnNewGame=this.game.querySelector(".game__new-game-btn"),this.btnOptions=this.game.querySelector(".game__options-btn"),this.gameBody=this.game.querySelector(".game__body"))});i(this,"addListeners",()=>{this.btnNewGame&&this.btnNewGame.addEventListener("click",this.newGame),this.btnOptions&&this.btnOptions.addEventListener("click",this.openOptions)});i(this,"newGame",()=>{if(this.game&&this.score&&this.moves&&this.gameBody&&!o.isGameStop){this.playGame=null,o.gameStarts(),this.gameBody.querySelectorAll(".game-cell").forEach(s=>s.remove());const e=new S(this.game).render;this.playGame=new E(this.score,this.moves,this.gameBody,e)}});i(this,"openOptions",()=>{this.game&&(this.rating?(this.rating.remove(),this.rating=null):this.rating=new L(this.game))});this.parentElement=e,this.activeParts(),this.addListeners(),this.gameBody&&(new c(this.gameBody,this.move),new b(this.move))}}class D{constructor(){new T(document.body),new R(document.body)}}new D;
